<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智慧运维系统 - 视频监控</title>
    <!-- 添加Font Awesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 添加导航栏模板JS文件引用 -->
    <script src="navbar-template.js"></script>
    <style>
        /* 全局样式 */
        :root {
            --primary-color: #49A18D; /* 清安绿 */
            --secondary-color: #2C7873; /* 深绿色 */
            --tertiary-color: #6FB3A8; /* 浅绿色 */
            --light-color: #E0F5F0; /* 特浅绿色 */
            --accent-color: #F39C12; /* 橙色作为点缀 */
            --danger-color: #E74C3C; /* 危险红色 */
            --warning-color: #F39C12; /* 警告黄色 */
            --success-color: #2ECC71; /* 成功绿色 */
            --text-color: #333333;
            --light-text: #FFFFFF;
            --border-color: #E0E0E0;
            --bg-color: #F5F5F5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', '微软雅黑', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 主内容区样式 */
        .main-content {
            flex: 1;
            padding: 20px;
            max-width: 100%;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        /* 页面头部 */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #666;
        }

        .breadcrumb span {
            margin: 0 5px;
            color: #999;
        }

        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            padding: 3px;
            width: 250px;
        }

        .search-box input {
            flex: 1;
            border: none;
            padding: 6px 8px;
            outline: none;
            font-size: 14px;
        }

        .search-box button {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 0 4px 4px 0;
        }

        .search-box button:hover {
            background-color: var(--light-color);
        }

        /* 视频监控网格 */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* 视频卡片样式 */
        .video-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9宽高比 */
            background-color: #000;
            overflow: hidden;
        }

        .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        .offline-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2;
            color: white;
        }

        .offline-overlay i {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--danger-color);
        }

        /* 视频状态标签 */
        .video-status {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            z-index: 3;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .status-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .status-normal {
            background-color: var(--success-color);
            color: white;
        }

        /* 天气信息 */
        .weather-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 3;
        }

        .weather-info i {
            font-size: 16px;
            color: var(--accent-color);
        }

        /* 站点信息部分 */
        .video-info {
            padding: 12px 15px;
        }

        .video-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .video-title h3 {
            color: var(--text-color);
            font-size: 16px;
            font-weight: 500;
        }

        .camera-count {
            background-color: var(--light-color);
            color: var(--primary-color);
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
        }

        .video-details {
            color: #666;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .video-controls {
            display: flex;
            gap: 8px;
        }

        .video-btn {
            flex: 1;
            padding: 8px 0;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .video-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .video-btn.primary:hover {
            background-color: var(--secondary-color);
        }

        .video-btn.secondary {
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .video-btn.secondary:hover {
            background-color: var(--light-color);
        }

        /* 筛选控件 */
        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-label {
            font-size: 14px;
            color: #666;
            min-width: 60px;
        }

        .filter-options {
            display: flex;
            gap: 10px;
        }

        .filter-option {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border-color);
            background-color: white;
        }

        .filter-option:hover {
            background-color: var(--light-color);
        }

        .filter-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* 视频模态框 */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            overflow: auto;
        }

        .modal-content {
            position: relative;
            width: 90%;
            max-width: 900px;
            margin: 40px auto;
            background-color: black;
            border-radius: 8px;
            overflow: hidden;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 36px;
            height: 36px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1010;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-video-container {
            width: 100%;
            padding-top: 56.25%;
            position: relative;
        }

        .modal-video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: rgb(20, 20, 20);
            color: white;
        }

        .camera-switcher {
            display: flex;
            gap: 8px;
        }

        .camera-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            transition: all 0.3s ease;
        }

        .camera-btn.active {
            background-color: var(--primary-color);
        }

        .camera-btn:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .video-playback-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .playback-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .playback-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .play-btn {
            width: 44px;
            height: 44px;
            font-size: 18px;
        }

        .timeline {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .timeline-progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0;
            transition: width 0.1s linear;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .video-grid {
                grid-template-columns: 1fr;
            }

            .header-right {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .search-box {
                width: 100%;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .filter-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-group {
                width: 100%;
            }

            .filter-options {
                flex-wrap: wrap;
            }

            .modal-content {
                width: 95%;
                margin: 20px auto;
            }

            .camera-switcher {
                flex-wrap: wrap;
            }
        }

        /* 放映时间选择组件 */
        .playback-time-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .time-select {
            padding: 6px 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        .time-select option {
            background-color: #222;
            color: white;
        }

        /* 导出按钮 */
        .export-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: var(--secondary-color);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background-color: var(--primary-color);
        }

        /* 摄像头叠加文字样式 */
        .camera-text-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 10px;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        .camera-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }

        .camera-timestamp {
            align-self: flex-end;
            font-size: 12px;
        }

        /* 视频噪点效果 */
        .noise-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 4;
            pointer-events: none;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAEcElEQVRogX2a23LkOgxDff//0zlnH1KJLkBIzsN0dWbsOJZEEqQkZ/vy7du3P3/+/On/4b/y9/7pX/td96tZ/mh2z/l+PE/glT1nM0L4d3/+GRdj494V0Xys1ef1upq1vdd4vl+z/7r3Wmu97pW1lu9HEFnrREPEdMg5RhZ/zjLBqvv1vD3kD0ZQmMGav67nfh4IHYKxBkQQMGaY8KxrDkHh0e+YYVvfcxXgHhQzBDBlAIGpPu1C7DHGRPvz8Bw71/qQWwDnEoDeITMmJGbqOZb0+RZUQZGJOQQCxLg2Qw1sAr9Ae1/NMpQiIQAzhb27Z0nzekzfI7GsbCDU+zbLIAEmxhnOxpD9yPRjKo0Zv8Ywg2vNmVr3nstYsb6SQMzReFfHcBifCQCsbGdYzzCA7G/GGDzLGGhKCVP+CqiMAXoxV2JfQIiRfm/GEJgbF0T2O6YHRrwfm5b54QnmzCxnBdAjJgSYHwf+vVczS0A/m6nJf/3JGS/9ZgwVoTKyESsDBwGGDQ9M9kxhbwLV+5np92KX/FI/FgNtYAzMZCpTnwh8MYUMV+GHGCpTvr6Xd8ZKmS1gByMbiO73xHRgWsGcKYBmCJnxszNZrJQtROqYshXEg4GUlqkuFLPqOgBm6sXnmYlL/NsrFVYyA4BKDSKVTqJ7yEZnJ9PVc9H/8k3WZKodMz2AysgQkJlJBKZSIZ9iTfQjwPW9Kb/SyIBDQHv+1AxmAImZLcEOcFPOasSZafp0pXxTWpXxpnTq3hkw5R0jBYBrHwDgMAv4Zu4m5cdGx8oRMAJuFW4qFAJmgLPZZWPcQGWK02+2Z9wrUGxc2+g2e8V4zXJU17YoZw0Yc0v9Z2YGQzHYwYYlMiO/Pc+2MxWmpA8ADrNBNMzYuFXYylbF9WC0+pGZQqCYcbYzmb5MXAB2rH9MgLPClfRjpGsQ6ZX0jCUECnD6T9Zl/IoxaGVKXiKxmUpF4NIw2z2zXYU4lZCaSBv3YIK1E+NIqx2T2UFmkAnGDqQPQJKVYs7bXYXu2rMYZ6B9ZZnk2K55S/pE7H/r2gHYVGXKUxSyaQrZ4iuvUc+Wc4FRdsBtzjuQfm9HKj/MbBVqmZpCTnqGOXtHUkj/lnRj5v8JuoFJJlJZQcYslYK9G5BNvzKD2P/rDC/TacwcaQWo+gwSS6VCVmyW8+s7kYL2b5aMbE97Lrz/6kqAyowbVdL5jJWZKnZXBqotqP+Sv9BG4AzYPzaGkFhBgK8gMsO/Uk+AwgBTXP9mtw6EEFtMIQ0A6c0IUm0bqDKVjXqtoSlMCBRArwqP1Vy+I/fNWAMRME2vgQiIzoaZWsMMYPVKBLVZy2bpR6KAwmkXAx9BsDGvtAOgrLm5lEZE2G/McBGEbDKQYsiBbgyEJdaK2axE2W92KqMGMMVarFTp6N/0G6bQ2dhXYB0wPj+lE6jYqkdj83ojNmILUGbsDPBT4OhBZgrxdQrG2jFCZt5TTGXRKmcjNYDYFGPFAHpV2FHIWC8ZO5U2MwWkMdZ47s/fv+Gt9MnPnNfFAAAAAElFTkSuQmCC');
            opacity: 0.05;
        }

        /* 视频闪烁效果 */
        @keyframes flicker {
            0% { opacity: 0.97; }
            2% { opacity: 0.9; }
            4% { opacity: 0.97; }
            19% { opacity: 0.97; }
            21% { opacity: 0.9; }
            23% { opacity: 0.97; }
            55% { opacity: 0.97; }
            57% { opacity: 0.9; }
            59% { opacity: 0.97; }
            89% { opacity: 0.97; }
            91% { opacity: 0.9; }
            93% { opacity: 0.97; }
        }

        .flicker-effect {
            animation: flicker 10s infinite;
        }

        /* 视频干扰线效果 */
        .glitch-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background-color: rgba(255, 255, 255, 0.4);
            z-index: 4;
            pointer-events: none;
            animation: glitch-animation 10s infinite linear;
        }

        @keyframes glitch-animation {
            0% { top: -5%; }
            10% { top: 20%; }
            20% { top: 80%; }
            30% { top: 40%; }
            40% { top: -5%; }
            50% { top: 100%; }
            60% { top: 70%; }
            70% { top: 10%; }
            80% { top: 90%; }
            90% { top: 30%; }
            100% { top: -5%; }
        }

        /* 添加自定义日期时间选择器样式 */
        .custom-time-selector {
            display: none;
            margin-left: 10px;
            align-items: center;
            gap: 10px;
        }

        .custom-time-selector.active {
            display: flex;
        }

        .datetime-input {
            padding: 6px 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        .datetime-input::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }

        .return-live-btn {
            padding: 6px 12px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .return-live-btn:hover {
            background-color: #c0392b;
        }

        .return-live-btn i {
            font-size: 12px;
        }

        /* 调整时间选择器布局 */
        .playback-time-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .time-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .apply-time-btn {
            padding: 6px 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .apply-time-btn:hover {
            background-color: var(--secondary-color);
        }
    </style>
</head>

<body>
    <!-- 导航栏容器 - 将由navbar-template.js动态填充 -->
    <div id="navbar-container"></div>

    <!-- 主内容区 -->
    <div class="main-content">
        <!-- 页面头部 -->
        <div class="page-header">
            <div class="header-left">
                <div class="breadcrumb">
                    <a href="dashboard.html">监控中心</a>
                    <span>/</span>
                    <a href="video-monitor.html" class="current">视频监控</a>
                </div>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <input type="text" id="site-search" placeholder="搜索站点名称...">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <button class="export-btn" id="export-data-btn">
                    <i class="fas fa-download"></i>
                    <span>导出数据</span>
                </button>
            </div>
        </div>

        <!-- 筛选控件 -->
        <div class="filter-controls">
            <div class="filter-group">
                <div class="filter-label">站点状态：</div>
                <div class="filter-options">
                    <div class="filter-option active" data-filter="all">全部</div>
                    <div class="filter-option" data-filter="warning">告警</div>
                    <div class="filter-option" data-filter="error">故障</div>
                    <div class="filter-option" data-filter="offline">设备离线</div>
                </div>
            </div>
            <div class="filter-group">
                <div class="filter-label">告警类型：</div>
                <div class="filter-options">
                    <div class="filter-option active" data-alarm="all">全部</div>
                    <div class="filter-option" data-alarm="intrusion">非法闯入</div>
                    <div class="filter-option" data-alarm="warning-zone">有人活动</div>
                </div>
            </div>
        </div>

        <!-- 视频监控网格 -->
        <div class="video-grid" id="video-grid">
            <!-- 视频卡片将通过JavaScript动态生成 -->
        </div>
    </div>

    <!-- 视频模态框 -->
    <div class="video-modal" id="video-modal">
        <div class="modal-content">
            <div class="modal-close" id="modal-close">
                <i class="fas fa-times"></i>
            </div>
            <div class="modal-video-container">
                <img src="" class="modal-video-placeholder" id="modal-video-image">
                <div class="timeline">
                    <div class="timeline-progress" id="timeline-progress"></div>
                </div>
            </div>
            <div class="modal-controls">
                <div class="camera-switcher" id="camera-switcher">
                    <!-- 摄像头切换按钮将通过JavaScript动态生成 -->
                </div>
                <div class="video-playback-controls">
                    <button class="playback-btn" id="rewind-btn">
                        <i class="fas fa-backward"></i>
                    </button>
                    <button class="playback-btn play-btn" id="play-btn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="playback-btn" id="forward-btn">
                        <i class="fas fa-forward"></i>
                    </button>
                    <div class="playback-time-selector">
                        <span class="time-label">时间：</span>
                        <select class="time-select" id="time-select">
                            <option value="live">实时</option>
                            <option value="1h">过去1小时</option>
                            <option value="6h">过去6小时</option>
                            <option value="24h">过去24小时</option>
                            <option value="7d">过去7天</option>
                            <option value="custom">自定义时间</option>
                        </select>
                        <div class="custom-time-selector" id="custom-time-selector">
                            <input type="datetime-local" class="datetime-input" id="custom-datetime">
                            <button class="apply-time-btn" id="apply-time-btn">应用</button>
                        </div>
                        <button class="return-live-btn" id="return-live-btn">
                            <i class="fas fa-circle"></i>
                            返回实时
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript代码 -->
    <script>
        // 站点视频数据，模拟数据
        const sitesData = [
            {
                id: 1,
                name: "重庆南岸区能源站",
                status: "normal",
                weather: { icon: "sun", temp: 28, humidity: 65 },
                cameras: [
                    { id: 101, name: "大门", status: "normal", image: null },
                    { id: 102, name: "储能电站正面", status: "normal", image: null },
                    { id: 103, name: "设备间", status: "normal", image: null }
                ],
                lastCheck: "2023-04-08 12:30"
            },
            {
                id: 2,
                name: "成都高新区能源站",
                status: "warning",
                alarmType: "warning-zone",
                weather: { icon: "cloud", temp: 26, humidity: 70 },
                cameras: [
                    { id: 201, name: "大门", status: "warning", image: null },
                    { id: 202, name: "设备间", status: "normal", image: null }
                ],
                lastCheck: "2023-04-08 10:15"
            },
            {
                id: 3,
                name: "贵阳清镇能源站",
                status: "error",
                alarmType: "intrusion",
                weather: { icon: "cloud-rain", temp: 22, humidity: 85 },
                cameras: [
                    { id: 301, name: "大门", status: "error", image: null },
                    { id: 302, name: "储能电站正面", status: "normal", image: null },
                    { id: 303, name: "逆变器区", status: "offline", image: null }
                ],
                lastCheck: "2023-04-08 09:45"
            },
            {
                id: 4,
                name: "重庆江北能源站",
                status: "normal",
                weather: { icon: "sun", temp: 27, humidity: 62 },
                cameras: [
                    { id: 401, name: "大门", status: "normal", image: null },
                    { id: 402, name: "设备间", status: "normal", image: null }
                ],
                lastCheck: "2023-04-08 11:20"
            },
            {
                id: 5,
                name: "北京朝阳能源站",
                status: "warning",
                alarmType: "warning-zone",
                weather: { icon: "sun", temp: 25, humidity: 45 },
                cameras: [
                    { id: 501, name: "大门", status: "warning", image: null },
                    { id: 502, name: "储能电站正面", status: "normal", image: null },
                    { id: 503, name: "配电区", status: "normal", image: null }
                ],
                lastCheck: "2023-04-08 10:50"
            },
            {
                id: 6,
                name: "上海浦东能源站",
                status: "offline",
                weather: { icon: "cloud", temp: 30, humidity: 75 },
                cameras: [
                    { id: 601, name: "大门", status: "offline", image: null },
                    { id: 602, name: "设备间", status: "offline", image: null }
                ],
                lastCheck: "2023-04-08 08:30"
            },
            {
                id: 7,
                name: "武汉东湖能源站",
                status: "error",
                alarmType: "intrusion",
                weather: { icon: "cloud-lightning", temp: 32, humidity: 80 },
                cameras: [
                    { id: 701, name: "大门", status: "error", image: null },
                    { id: 702, name: "储能电站正面", status: "warning", image: null }
                ],
                lastCheck: "2023-04-08 09:10"
            },
            {
                id: 8,
                name: "深圳南山能源站",
                status: "warning",
                alarmType: "warning-zone",
                weather: { icon: "cloud-rain", temp: 31, humidity: 85 },
                cameras: [
                    { id: 801, name: "大门", status: "normal", image: null },
                    { id: 802, name: "设备间", status: "warning", image: null },
                    { id: 803, name: "储能电站正面", status: "normal", image: null }
                ],
                lastCheck: "2023-04-08 11:40"
            }
        ];

        // 生成模拟的图片URL（使用placeholder.com服务生成占位图片）
        function generatePlaceholderImageUrl(width, height, text) {
            // 根据不同的摄像头状态使用不同的背景色
            let bgColor, textColor;
            if (text.includes("error") || text.includes("故障")) {
                bgColor = "E74C3C";
                textColor = "FFFFFF";
            } else if (text.includes("warning") || text.includes("警告")) {
                bgColor = "F39C12";
                textColor = "FFFFFF";
            } else if (text.includes("offline") || text.includes("离线")) {
                bgColor = "7F8C8D";
                textColor = "FFFFFF";
            } else {
                bgColor = "49A18D";
                textColor = "FFFFFF";
            }
            
            return `https://via.placeholder.com/${width}x${height}/${bgColor}/${textColor}/?text=${encodeURIComponent(text)}`;
        }

        // 替换为更真实的监控视频图像生成函数
        function generatePlaceholderImageUrl(width, height, text) {
            // 提取站点名称和摄像头类型
            const parts = text.split('\n');
            const siteName = parts[0] || '';
            const cameraType = parts[1] || '';
            
            // 基于摄像头类型和站点，生成一个固定的随机种子
            let seed = 0;
            for (let i = 0; i < siteName.length; i++) {
                seed += siteName.charCodeAt(i);
            }
            for (let i = 0; i < cameraType.length; i++) {
                seed += cameraType.charCodeAt(i);
            }
            
            // 根据摄像头类型选择不同的图像
            let imageId = (seed % 30) + 1; // 1-30之间的随机数
            
            // 如果是离线状态，添加灰度滤镜
            let filter = '';
            if (text.includes("offline") || text.includes("离线")) {
                filter = '&blur=2&grayscale'; // 添加模糊和灰度效果
                return `https://picsum.photos/id/${imageId}/${width}/${height}${filter}`;
            }
            
            // 如果是故障状态，添加噪点效果
            if (text.includes("error") || text.includes("故障")) {
                filter = '&blur=1'; // 添加轻微模糊效果
                // 对于故障类型，使用特定的"监控风格"图像
                if (cameraType.includes("大门")) {
                    return `https://picsum.photos/id/3${imageId}/${width}/${height}${filter}`;
                } else {
                    return `https://picsum.photos/id/4${imageId}/${width}/${height}${filter}`;
                }
            }
            
            // 如果是警告状态，增加对比度
            if (text.includes("warning") || text.includes("警告")) {
                filter = '&contrast=150';
                // 对于警告类型，使用特定的"监控风格"图像
                if (cameraType.includes("警戒区")) {
                    return `https://picsum.photos/id/5${imageId}/${width}/${height}${filter}`;
                } else {
                    return `https://picsum.photos/id/6${imageId}/${width}/${height}${filter}`;
                }
            }
            
            // 根据摄像头类型选择不同的基础图像
            if (cameraType.includes("大门")) {
                // 大门类型的摄像头 - 使用建筑或入口相关图像
                return `https://picsum.photos/id/${100 + (imageId % 20)}/${width}/${height}`;
            } else if (cameraType.includes("蓄电池区")) {
                // 蓄电池区 - 使用设备/技术相关图像
                return `https://picsum.photos/id/${200 + (imageId % 20)}/${width}/${height}`;
            } else if (cameraType.includes("设备间")) {
                // 设备间 - 使用室内/设备相关图像
                return `https://picsum.photos/id/${300 + (imageId % 20)}/${width}/${height}`;
            } else if (cameraType.includes("逆变器区")) {
                // 逆变器区 - 使用技术设备相关图像
                return `https://picsum.photos/id/${400 + (imageId % 20)}/${width}/${height}`;
            } else {
                // 默认图像
                return `https://picsum.photos/id/${imageId}/${width}/${height}`;
            }
        }

        // 获取天气图标
        function getWeatherIcon(iconName) {
            switch(iconName) {
                case 'sun': return '<i class="fas fa-sun"></i>';
                case 'cloud': return '<i class="fas fa-cloud"></i>';
                case 'cloud-rain': return '<i class="fas fa-cloud-rain"></i>';
                case 'cloud-lightning': return '<i class="fas fa-bolt"></i>';
                default: return '<i class="fas fa-sun"></i>';
            }
        }

        // 获取状态标签内容
        function getStatusLabel(status, alarmType) {
            if (status === 'error') {
                if (alarmType === 'intrusion') {
                    return '<div class="video-status status-danger"><i class="fas fa-user-ninja"></i> 非法闯入</div>';
                } else {
                    return '<div class="video-status status-danger"><i class="fas fa-exclamation-triangle"></i> 摄像头故障</div>';
                }
            } else if (status === 'warning') {
                if (alarmType === 'warning-zone') {
                    return '<div class="video-status status-warning"><i class="fas fa-exclamation-circle"></i> 有人活动</div>';
                } else {
                    return '<div class="video-status status-warning"><i class="fas fa-exclamation-circle"></i> 异常警告</div>';
                }
            } else if (status === 'offline') {
                return '<div class="video-status status-danger"><i class="fas fa-power-off"></i> 设备离线</div>';
            }
            return '';
        }

        // 获取相机状态文本
        function getCameraStatusText(status) {
            switch(status) {
                case 'normal': return '正常';
                case 'warning': return '警告';
                case 'error': return '故障';
                case 'offline': return '离线';
                default: return '未知';
            }
        }

        // 渲染所有监控卡片
        function renderVideoCards(sites = sitesData) {
            const videoGrid = document.getElementById('video-grid');
            videoGrid.innerHTML = '';

            sites.forEach(site => {
                // 选择第一个摄像头作为卡片显示
                const mainCamera = site.cameras[0];
                
                // 计算摄像头状态
                let isAnyOffline = site.cameras.some(cam => cam.status === 'offline');
                let offlineCount = site.cameras.filter(cam => cam.status === 'offline').length;
                
                // 使用占位图片代替实际摄像头图像
                const imageUrl = mainCamera.image || generatePlaceholderImageUrl(640, 360, `${site.name}\n${mainCamera.name}`);
                
                // 为了使卡片更逼真，添加视频特效
                let videoEffects = '';
                if (mainCamera.status === 'error' || site.status === 'error') {
                    videoEffects = `
                        <div class="noise-effect"></div>
                        <div class="glitch-line"></div>
                    `;
                } else if (mainCamera.status === 'warning' || site.status === 'warning') {
                    videoEffects = `<div class="noise-effect"></div>`;
                } else if (mainCamera.status !== 'offline') {
                    videoEffects = `<div class="flicker-effect"></div>`;
                }
                
                // 创建卡片HTML
                const cardHtml = `
                    <div class="video-card" data-site-id="${site.id}" data-status="${site.status}" data-alarm-type="${site.alarmType || ''}">
                        <div class="video-container">
                            <img src="${imageUrl}" class="video-placeholder" alt="${site.name}的摄像头图像">
                            ${getStatusLabel(site.status, site.alarmType)}
                            <div class="weather-info">
                                ${getWeatherIcon(site.weather.icon)}
                                <span>${site.weather.temp}°C / ${site.weather.humidity}%</span>
                            </div>
                            ${mainCamera.status === 'offline' ? `
                            <div class="offline-overlay">
                                <i class="fas fa-video-slash"></i>
                                <span>摄像头离线</span>
                            </div>
                            ` : videoEffects}
                        </div>
                        <div class="video-info">
                            <div class="video-title">
                                <h3>${site.name}</h3>
                                <div class="camera-count">${site.cameras.length}个摄像头</div>
                            </div>
                            <div class="video-details">
                                <p>最后检查时间: ${site.lastCheck}</p>
                                <p>摄像头状态: ${isAnyOffline ? `${offlineCount}/${site.cameras.length} 离线` : '全部在线'}</p>
                            </div>
                            <div class="video-controls">
                                <button class="video-btn primary view-btn" data-site-id="${site.id}">
                                    <i class="fas fa-play-circle"></i>
                                    查看监控
                                </button>
                                <button class="video-btn secondary history-btn" data-site-id="${site.id}">
                                    <i class="fas fa-history"></i>
                                    回放
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                videoGrid.innerHTML += cardHtml;
            });
            
            // 添加事件监听器
            addCardEventListeners();
            
            // 为每个卡片添加摄像头叠加文字
            document.querySelectorAll('.video-card').forEach(card => {
                const siteId = parseInt(card.getAttribute('data-site-id'));
                const site = sitesData.find(s => s.id === siteId);
                if (site) {
                    const mainCamera = site.cameras[0];
                    const videoContainer = card.querySelector('.video-container');
                    addCameraOverlay(siteId, mainCamera.name, mainCamera.status, videoContainer);
                }
            });
        }

        // 添加卡片事件监听器
        function addCardEventListeners() {
            // 查看监控按钮点击事件
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const siteId = parseInt(this.getAttribute('data-site-id'));
                    openVideoModal(siteId, 'live');
                });
            });
            
            // 历史回放按钮点击事件
            document.querySelectorAll('.history-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const siteId = parseInt(this.getAttribute('data-site-id'));
                    openVideoModal(siteId, '24h');
                });
            });
            
            // 点击卡片任何区域也可以打开监控
            document.querySelectorAll('.video-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    // 如果点击的是按钮区域，不做处理（让按钮自己的事件处理）
                    if (e.target.closest('.video-btn')) {
                        return;
                    }
                    
                    const siteId = parseInt(this.getAttribute('data-site-id'));
                    openVideoModal(siteId, 'live');
                });
            });
        }

        // 打开视频模态框
        function openVideoModal(siteId, timeframe = 'live') {
            const site = sitesData.find(s => s.id === siteId);
            if (!site) return;
            
            const modal = document.getElementById('video-modal');
            const modalVideo = document.getElementById('modal-video-image');
            const cameraSwitcher = document.getElementById('camera-switcher');
            const timeSelect = document.getElementById('time-select');
            const playBtn = document.getElementById('play-btn');
            
            // 获取第一个摄像头
            const firstCamera = site.cameras[0];
            
            // 设置初始视频图像
            const initialImageUrl = firstCamera.image || generatePlaceholderImageUrl(1280, 720, `${site.name}\n${firstCamera.name}`);
            modalVideo.src = initialImageUrl;
            
            // 生成摄像头切换按钮
            cameraSwitcher.innerHTML = '';
            site.cameras.forEach((camera, index) => {
                const cameraBtn = document.createElement('button');
                cameraBtn.className = `camera-btn ${index === 0 ? 'active' : ''}`;
                cameraBtn.setAttribute('data-camera-id', camera.id);
                cameraBtn.textContent = camera.name;
                
                // 点击切换摄像头
                cameraBtn.addEventListener('click', function() {
                    document.querySelectorAll('.camera-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更换视频图像
                    const cameraImageUrl = camera.image || generatePlaceholderImageUrl(1280, 720, `${site.name}\n${camera.name}`);
                    modalVideo.src = cameraImageUrl;
                    
                    // 如果是离线状态，显示离线覆盖层
                    const isOffline = camera.status === 'offline';
                    let offlineOverlay = document.querySelector('.modal-video-container .offline-overlay');
                    
                    if (isOffline) {
                        if (!offlineOverlay) {
                            offlineOverlay = document.createElement('div');
                            offlineOverlay.className = 'offline-overlay';
                            offlineOverlay.innerHTML = `
                                <i class="fas fa-video-slash"></i>
                                <span>摄像头离线</span>
                            `;
                            document.querySelector('.modal-video-container').appendChild(offlineOverlay);
                        }
                    } else if (offlineOverlay) {
                        offlineOverlay.remove();
                    }
                    
                    // 添加或更新摄像头叠加信息
                    const modalVideoContainer = document.querySelector('.modal-video-container');
                    addCameraOverlay(site.id, camera.name, camera.status, modalVideoContainer);
                    
                    // 清除现有的特效
                    document.querySelectorAll('.modal-video-container .noise-effect, .modal-video-container .glitch-line, .modal-video-container .flicker-effect').forEach(el => el.remove());
                    
                    // 根据摄像头状态添加特效
                    if (camera.status === 'error') {
                        const noiseEffect = document.createElement('div');
                        noiseEffect.className = 'noise-effect';
                        modalVideoContainer.appendChild(noiseEffect);
                        
                        const glitchLine = document.createElement('div');
                        glitchLine.className = 'glitch-line';
                        modalVideoContainer.appendChild(glitchLine);
                    } else if (camera.status === 'warning') {
                        const noiseEffect = document.createElement('div');
                        noiseEffect.className = 'noise-effect';
                        modalVideoContainer.appendChild(noiseEffect);
                    } else if (camera.status === 'normal') {
                        const flickerEffect = document.createElement('div');
                        flickerEffect.className = 'flicker-effect';
                        modalVideoContainer.appendChild(flickerEffect);
                    }
                    
                    // 重置回放状态
                    resetPlayback();
                });
                
                cameraSwitcher.appendChild(cameraBtn);
            });
            
            // 设置时间范围
            timeSelect.value = timeframe;
            
            // 显示模态框
            modal.style.display = 'block';
            
            // 清除现有的特效和叠加层
            document.querySelectorAll('.modal-video-container .noise-effect, .modal-video-container .glitch-line, .modal-video-container .flicker-effect, .modal-video-container .camera-text-overlay').forEach(el => el.remove());
            
            // 添加摄像头叠加信息
            const modalVideoContainer = document.querySelector('.modal-video-container');
            addCameraOverlay(site.id, firstCamera.name, firstCamera.status, modalVideoContainer);
            
            // 根据摄像头状态添加特效
            if (firstCamera.status === 'error') {
                const noiseEffect = document.createElement('div');
                noiseEffect.className = 'noise-effect';
                modalVideoContainer.appendChild(noiseEffect);
                
                const glitchLine = document.createElement('div');
                glitchLine.className = 'glitch-line';
                modalVideoContainer.appendChild(glitchLine);
            } else if (firstCamera.status === 'warning') {
                const noiseEffect = document.createElement('div');
                noiseEffect.className = 'noise-effect';
                modalVideoContainer.appendChild(noiseEffect);
            } else if (firstCamera.status === 'normal') {
                const flickerEffect = document.createElement('div');
                flickerEffect.className = 'flicker-effect';
                modalVideoContainer.appendChild(flickerEffect);
            }
            
            // 初始化回放控制
            resetPlayback();
            
            // 如果选择了'live'以外的时间，自动开始回放
            if (timeframe !== 'live') {
                startPlayback();
            }
            
            // 检查第一个摄像头是否是离线状态
            if (firstCamera.status === 'offline') {
                let offlineOverlay = document.querySelector('.modal-video-container .offline-overlay');
                if (!offlineOverlay) {
                    offlineOverlay = document.createElement('div');
                    offlineOverlay.className = 'offline-overlay';
                    offlineOverlay.innerHTML = `
                        <i class="fas fa-video-slash"></i>
                        <span>摄像头离线</span>
                    `;
                    document.querySelector('.modal-video-container').appendChild(offlineOverlay);
                }
            }
        }

        // 关闭视频模态框
        function closeVideoModal() {
            const modal = document.getElementById('video-modal');
            modal.style.display = 'none';
            
            // 停止回放
            stopPlayback();
        }

        // 重置回放状态
        function resetPlayback() {
            const playBtn = document.getElementById('play-btn');
            const timelineProgress = document.getElementById('timeline-progress');
            
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
            timelineProgress.style.width = '0%';
            
            // 清除任何进行中的回放
            if (window.playbackInterval) {
                clearInterval(window.playbackInterval);
                window.playbackInterval = null;
            }
        }

        // 开始回放
        function startPlayback() {
            const playBtn = document.getElementById('play-btn');
            const timelineProgress = document.getElementById('timeline-progress');
            const timeSelect = document.getElementById('time-select');
            const customDatetime = document.getElementById('custom-datetime');
            
            // 更改播放按钮图标
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            
            // 获取回放开始时间
            let startTimeText = "";
            if (timeSelect.value === 'custom' && customDatetime.value) {
                // 格式化自定义日期时间为友好的显示文本
                const selectedDate = new Date(customDatetime.value);
                startTimeText = selectedDate.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            } else {
                // 处理预设选项
                switch(timeSelect.value) {
                    case '1h': startTimeText = "1小时前"; break;
                    case '6h': startTimeText = "6小时前"; break;
                    case '24h': startTimeText = "24小时前"; break;
                    case '7d': startTimeText = "7天前"; break;
                    default: startTimeText = "自定义时间";
                }
            }
            
            // 更新时间戳文本显示回放模式和开始时间
            const timestamp = document.querySelector('.modal-video-container .camera-timestamp');
            if (timestamp) {
                timestamp.innerHTML = `<span style="color:#F39C12">回放模式 - 开始于: ${startTimeText}</span>`;
            }
            
            // 模拟回放进度
            let progress = 0;
            if (window.playbackInterval) {
                clearInterval(window.playbackInterval);
            }
            
            window.playbackInterval = setInterval(() => {
                progress += 0.5;
                timelineProgress.style.width = `${progress}%`;
                
                // 更新时间戳，模拟时间前进
                updatePlaybackTimestamp(progress, startTimeText);
                
                // 到达100%时，停止回放
                if (progress >= 100) {
                    stopPlayback();
                }
            }, 200);
            
            // 显示返回实时按钮
            document.getElementById('return-live-btn').style.display = 'flex';
        }
        
        // 更新回放时间戳
        function updatePlaybackTimestamp(progress, startTimeText) {
            const timestamp = document.querySelector('.modal-video-container .camera-timestamp');
            if (!timestamp) return;
            
            // 根据进度模拟时间前进
            let now = new Date();
            
            if (progress < 100) {
                timestamp.innerHTML = `<span style="color:#F39C12">回放模式 - 开始于: ${startTimeText}</span>`;
            } else {
                // 回放结束后回到当前时间
                timestamp.textContent = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
            }
        }
        
        // 返回实时监控
        function returnToLive() {
            const timeSelect = document.getElementById('time-select');
            timeSelect.value = 'live';
            
            // 停止回放
            stopPlayback();
            
            // 隐藏自定义时间选择器
            document.getElementById('custom-time-selector').classList.remove('active');
            
            // 更新时间戳为实时
            const timestamp = document.querySelector('.modal-video-container .camera-timestamp');
            if (timestamp) {
                const now = new Date();
                timestamp.textContent = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                
                // 恢复时间戳更新
                if (window.timestampInterval) {
                    clearInterval(window.timestampInterval);
                }
                
                window.timestampInterval = setInterval(() => {
                    if (timestamp) {
                        const now = new Date();
                        timestamp.textContent = now.toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: false
                        });
                    }
                }, 1000);
            }
            
            // 隐藏返回实时按钮
            document.getElementById('return-live-btn').style.display = 'none';
        }

        // 停止回放
        function stopPlayback() {
            const playBtn = document.getElementById('play-btn');
            
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
            
            if (window.playbackInterval) {
                clearInterval(window.playbackInterval);
                window.playbackInterval = null;
            }
        }

        // 切换回放状态
        function togglePlayback() {
            const playBtn = document.getElementById('play-btn');
            
            if (window.playbackInterval) {
                stopPlayback();
            } else {
                startPlayback();
            }
        }

        // 过滤站点卡片
        function filterSites() {
            // 获取当前筛选条件
            const statusFilter = document.querySelector('.filter-option[data-filter].active').getAttribute('data-filter');
            const alarmFilter = document.querySelector('.filter-option[data-alarm].active').getAttribute('data-alarm');
            
            // 获取搜索关键词
            const searchInput = document.getElementById('site-search');
            const keyword = searchInput ? searchInput.value.toLowerCase().trim() : '';
            
            // 过滤站点数据
            let filteredSites = sitesData;
            
            // 应用状态筛选
            if (statusFilter !== 'all') {
                filteredSites = filteredSites.filter(site => site.status === statusFilter);
            }
            
            // 应用告警类型筛选
            if (alarmFilter !== 'all') {
                filteredSites = filteredSites.filter(site => site.alarmType === alarmFilter);
            }
            
            // 应用搜索关键词筛选
            if (keyword) {
                filteredSites = filteredSites.filter(site => 
                    site.name.toLowerCase().includes(keyword)
                );
            }
            
            // 重新渲染卡片
            renderVideoCards(filteredSites);
            
            // 如果没有匹配的结果，显示提示信息
            const videoGrid = document.getElementById('video-grid');
            if (filteredSites.length === 0) {
                videoGrid.innerHTML = '<div style="text-align: center; padding: 30px; grid-column: 1/-1; color: #666;">没有符合条件的监控站点</div>';
            }
        }

        // 添加摄像头动态效果，随机切换不同摄像头的图像
        function setupCameraMotionEffect() {
            // 只对正常状态的摄像头应用动态效果
            sitesData.forEach(site => {
                const normalCameras = site.cameras.filter(cam => cam.status === 'normal');
                if (normalCameras.length > 0) {
                    // 每隔一段随机时间，切换一次摄像头的图像
                    setInterval(() => {
                        // 随机选择一个角度变化
                        const randomAngle = Math.floor(Math.random() * 10) - 5; // -5到5度之间
                        
                        // 找到这个站点的卡片
                        const card = document.querySelector(`.video-card[data-site-id="${site.id}"]`);
                        if (card) {
                            const img = card.querySelector('.video-placeholder');
                            if (img) {
                                // 应用一个小的变换，模拟摄像头的微小移动
                                img.style.transition = 'transform 2s ease-in-out';
                                img.style.transform = `scale(1.02) rotate(${randomAngle}deg)`;
                                
                                // 一段时间后恢复到原始状态
                                setTimeout(() => {
                                    img.style.transform = 'scale(1) rotate(0deg)';
                                }, 2000);
                            }
                        }
                    }, 8000 + Math.random() * 5000); // 每8-13秒随机触发一次
                }
            });
            
            // 随机生成移动的物体（例如人或车辆），创造活动感
            setInterval(() => {
                // 随机选择一个站点
                const randomSiteIndex = Math.floor(Math.random() * sitesData.length);
                const site = sitesData[randomSiteIndex];
                
                // 只在正常或警告状态的摄像头上显示移动物体
                const activeCameras = site.cameras.filter(cam => cam.status === 'normal' || cam.status === 'warning');
                if (activeCameras.length > 0) {
                    // 随机选择一个摄像头
                    const randomCameraIndex = Math.floor(Math.random() * activeCameras.length);
                    const camera = activeCameras[randomCameraIndex];
                    
                    // 找到这个站点的卡片
                    const card = document.querySelector(`.video-card[data-site-id="${site.id}"]`);
                    if (card && camera.name === site.cameras[0].name) { // 只有当显示的是第一个摄像头时才显示移动效果
                        const videoContainer = card.querySelector('.video-container');
                        if (videoContainer) {
                            // 创建移动物体
                            const movingObject = document.createElement('div');
                            movingObject.className = 'moving-object';
                            movingObject.style.position = 'absolute';
                            movingObject.style.width = '15px';
                            movingObject.style.height = '15px';
                            movingObject.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
                            movingObject.style.borderRadius = '50%';
                            movingObject.style.zIndex = '3';
                            
                            // 随机起始位置
                            const startX = Math.random() * 100;
                            const startY = Math.random() * 100;
                            movingObject.style.left = `${startX}%`;
                            movingObject.style.top = `${startY}%`;
                            
                            // 添加到容器
                            videoContainer.appendChild(movingObject);
                            
                            // 设置动画
                            const endX = Math.random() * 100;
                            const endY = Math.random() * 100;
                            movingObject.animate([
                                { left: `${startX}%`, top: `${startY}%` },
                                { left: `${endX}%`, top: `${endY}%` }
                            ], {
                                duration: 5000,
                                easing: 'linear'
                            });
                            
                            // 动画结束后移除
                            setTimeout(() => {
                                movingObject.remove();
                            }, 5000);
                        }
                    }
                }
            }, 15000 + Math.random() * 10000); // 每15-25秒随机触发一次
        }
        
        // 初始化页面
        function initPage() {
            // 渲染监控卡片
            renderVideoCards();
            
            // 添加筛选事件监听器
            document.querySelectorAll('.filter-option[data-filter]').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.filter-option[data-filter]').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    filterSites();
                });
            });
            
            document.querySelectorAll('.filter-option[data-alarm]').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.filter-option[data-alarm]').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    filterSites();
                });
            });
            
            // 添加搜索功能
            const searchInput = document.getElementById('site-search');
            const searchBtn = document.getElementById('search-btn');
            
            if (searchInput) {
                searchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        filterSites();
                    }
                });
            }
            
            if (searchBtn) {
                searchBtn.addEventListener('click', filterSites);
            }
            
            // 模态框关闭按钮
            const modalClose = document.getElementById('modal-close');
            if (modalClose) {
                modalClose.addEventListener('click', closeVideoModal);
            }
            
            // 回放控制按钮
            const playBtn = document.getElementById('play-btn');
            const rewindBtn = document.getElementById('rewind-btn');
            const forwardBtn = document.getElementById('forward-btn');
            const timeSelect = document.getElementById('time-select');
            const customDatetime = document.getElementById('custom-datetime');
            const applyTimeBtn = document.getElementById('apply-time-btn');
            const returnLiveBtn = document.getElementById('return-live-btn');
            const customTimeSelector = document.getElementById('custom-time-selector');
            
            if (playBtn) {
                playBtn.addEventListener('click', togglePlayback);
            }
            
            if (timeSelect) {
                timeSelect.addEventListener('change', function() {
                    resetPlayback();
                    
                    // 处理自定义时间选项
                    if (this.value === 'custom') {
                        customTimeSelector.classList.add('active');
                        
                        // 设置默认值为当前时间
                        const now = new Date();
                        // 格式化为datetime-local输入所需的格式: YYYY-MM-DDThh:mm
                        const year = now.getFullYear();
                        const month = String(now.getMonth() + 1).padStart(2, '0');
                        const day = String(now.getDate()).padStart(2, '0');
                        const hours = String(now.getHours()).padStart(2, '0');
                        const minutes = String(now.getMinutes()).padStart(2, '0');
                        
                        customDatetime.value = `${year}-${month}-${day}T${hours}:${minutes}`;
                    } else {
                        customTimeSelector.classList.remove('active');
                        
                        if (this.value !== 'live') {
                            startPlayback();
                        } else {
                            returnToLive();
                        }
                    }
                });
            }
            
            if (applyTimeBtn) {
                applyTimeBtn.addEventListener('click', function() {
                    if (customDatetime.value) {
                        startPlayback();
                    } else {
                        alert('请选择有效的日期和时间');
                    }
                });
            }
            
            if (returnLiveBtn) {
                returnLiveBtn.addEventListener('click', returnToLive);
                // 初始状态下隐藏
                returnLiveBtn.style.display = 'none';
            }
            
            if (rewindBtn) {
                rewindBtn.addEventListener('click', function() {
                    const timelineProgress = document.getElementById('timeline-progress');
                    let currentWidth = parseFloat(timelineProgress.style.width || '0');
                    if (currentWidth > 0) {
                        // 后退10%
                        currentWidth = Math.max(0, currentWidth - 10);
                        timelineProgress.style.width = `${currentWidth}%`;
                    }
                });
            }
            
            if (forwardBtn) {
                forwardBtn.addEventListener('click', function() {
                    const timelineProgress = document.getElementById('timeline-progress');
                    let currentWidth = parseFloat(timelineProgress.style.width || '0');
                    if (currentWidth < 100) {
                        // 前进10%
                        currentWidth = Math.min(100, currentWidth + 10);
                        timelineProgress.style.width = `${currentWidth}%`;
                    }
                });
            }
            
            // 导出数据按钮
            const exportBtn = document.getElementById('export-data-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', function() {
                    alert('该功能待精进优化');
                });
            }
            
            if (customDatetime) {
                // 设置最大值为当前时间
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                
                customDatetime.max = `${year}-${month}-${day}T${hours}:${minutes}`;
                
                // 设置最小值为30天前
                const thirtyDaysAgo = new Date(now);
                thirtyDaysAgo.setDate(now.getDate() - 30);
                const yearMin = thirtyDaysAgo.getFullYear();
                const monthMin = String(thirtyDaysAgo.getMonth() + 1).padStart(2, '0');
                const dayMin = String(thirtyDaysAgo.getDate()).padStart(2, '0');
                
                customDatetime.min = `${yearMin}-${monthMin}-${dayMin}T00:00`;
            }
            
            // 启动摄像头动态效果
            setupCameraMotionEffect();
        }

        // 添加叠加文字标签的函数，使监控更加真实
        function addCameraOverlay(siteId, cameraName, status, element) {
            if (!element) return;
            
            // 清除现有的叠加层
            const existingOverlay = element.querySelector('.camera-text-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
            
            // 添加摄像头信息和时间戳叠加层
            const overlay = document.createElement('div');
            overlay.className = 'camera-text-overlay';
            
            // 获取当前时间
            const now = new Date();
            const timeString = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            
            // 创建HTML内容
            overlay.innerHTML = `
                <div class="camera-timestamp">${timeString}</div>
            `;
            
            // 添加到元素
            element.appendChild(overlay);
            
            // 如果是在模态框中，启动时间戳更新
            if (element.closest('.modal-video-container')) {
                // 清除之前的计时器
                if (window.timestampInterval) {
                    clearInterval(window.timestampInterval);
                }
                
                // 设置新的计时器，每秒更新时间戳
                window.timestampInterval = setInterval(() => {
                    const timestamp = element.querySelector('.camera-timestamp');
                    if (timestamp) {
                        const now = new Date();
                        timestamp.textContent = now.toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: false
                        });
                    }
                }, 1000);
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html> 