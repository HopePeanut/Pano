<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘Šè­¦æ¨é€æ¨¡æ¿é€‰ç”¨ - æ™ºæ…§è¿ç»´ç³»ç»Ÿ</title>
    <!-- å¼•å…¥ Font Awesome å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- å¼•å…¥å¯¼èˆªæ æ¨¡æ¿JS -->
    <script src="navbar-template.js"></script>
    <style>
        /* --- åŸºç¡€æ ·å¼å’Œå˜é‡ (å‚è€ƒ site-config.html) --- */
        :root {
            --primary-color: #49A18D; /* æ¸…å®‰ç»¿ */
            --secondary-color: #3D8C7D;
            --light-color: #F5F7F9;
            --border-color: #E2E8F0;
            --text-color: #333333;
            --light-text: #FFFFFF;
            --gray-text: #6C757D;
            --radius: 8px;
            --shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            --warning-color: #F59E0B; /* æ©™è‰²ï¼Œç”¨äºæç¤º */
            --danger-color: #e53e3e; /* çº¢è‰²ï¼Œç”¨äºåˆ é™¤/é”™è¯¯ */
            --info-color: #4299e1; /* è“è‰²ï¼Œç”¨äºä¿¡æ¯/ç¼–è¾‘ */
            --table-hover-bg: rgba(73, 161, 141, 0.05);
            --table-header-bg: #f5f7f9;
            --disabled-bg: #f1f5f9; /* ç¦ç”¨èƒŒæ™¯è‰² */
            --disabled-text: #94a3b8; /* ç¦ç”¨æ–‡å­—é¢œè‰² */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #FAFAFA;
            color: var(--text-color);
            font-size: 14px;
        }

        .main-content {
            padding: 20px;
            max-width: 1300px; /* ä¿æŒä¸ site-config ä¸€è‡´ */
            margin: 0 auto;
        }

        /* --- é¢åŒ…å±‘å¯¼èˆª --- */
        .breadcrumb {
            display: flex;
            padding: 10px 0;
            margin-bottom: 20px;
            list-style: none;
            font-size: 0.9rem;
        }
        .breadcrumb-item { color: var(--gray-text); }
        .breadcrumb-item a { color: var(--gray-text); text-decoration: none; }
        .breadcrumb-item a:hover { color: var(--primary-color); }
        .breadcrumb-item + .breadcrumb-item::before { content: "/"; padding: 0 8px; color: var(--gray-text); }
        .breadcrumb-item.active { color: var(--primary-color); font-weight: 500; }

        /* --- é¡µé¢æ ‡é¢˜ --- */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background-color: white;
            padding: 15px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        .page-title { font-size: 1.5rem; font-weight: 500; color: var(--text-color); }

        /* --- å†…å®¹å—æ ·å¼ --- */
        .content-block {
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 25px; /* å¢åŠ å—é—´è· */
        }
        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .block-title {
            font-size: 1.15rem; /* ç¨å°çš„æ ‡é¢˜ */
            font-weight: 500;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .block-title i {
            font-size: 1.1rem;
        }

        /* --- æŒ‰é’®æ ·å¼ --- */
        .btn {
            padding: 8px 16px;
            border-radius: var(--radius);
            font-size: 14px; /* åŸºç¡€æŒ‰é’®å­—å· */
            cursor: pointer;
            display: inline-flex; /* ä½¿ç”¨ inline-flex */
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.2s ease;
            border: none;
            font-weight: normal;
            white-space: nowrap; /* é˜²æ­¢æŒ‰é’®æ–‡å­—æ¢è¡Œ */
            line-height: 1.5; /* ç¡®ä¿æ–‡å­—å‚ç›´å±…ä¸­ */
        }
        .btn i { font-size: 14px; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--secondary-color); }
        .btn-secondary { background-color: white; color: var(--text-color); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background-color: var(--light-color); }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-danger:hover { background-color: #c53030; }
        .btn-warning { background-color: var(--warning-color); color: white; }
        .btn-warning:hover { background-color: #dd6b20; }
        .btn-small { padding: 5px 10px; font-size: 13px; }

        /* --- è¡¨æ ¼æ ·å¼ --- */
        .table-container { overflow-x: auto; } /* å…è®¸è¡¨æ ¼æ°´å¹³æ»šåŠ¨ */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            margin-top: 15px; /* è¡¨æ ¼ä¸ä¸Šæ–¹å…ƒç´ çš„é—´è· */
        }
        thead { background-color: var(--table-header-bg); }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle; /* å‚ç›´å±…ä¸­ */
            white-space: nowrap; /* é˜²æ­¢å•å…ƒæ ¼å†…å®¹æ¢è¡Œ */
        }
        th { font-weight: 500; color: var(--gray-text); font-size: 14px; }
        tbody tr:hover { background-color: var(--table-hover-bg); }

        /* è¡¨æ ¼æ“ä½œæŒ‰é’® */
        .action-btns { display: flex; gap: 10px; align-items: center; }
        .action-btn {
            background: none; border: none; cursor: pointer;
            font-size: 16px; color: var(--gray-text); transition: color 0.2s;
            padding: 0; line-height: 1;
        }
        .action-btn.edit:hover { color: var(--info-color); }
        .action-btn.delete:hover { color: var(--danger-color); }

        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .status-active { background-color: rgba(73, 161, 141, 0.1); color: var(--primary-color); }
        .status-inactive { background-color: rgba(108, 117, 125, 0.1); color: var(--gray-text); } /* ç°è‰²è¡¨ç¤ºåœç”¨ */
        .status-warning { background-color: rgba(245, 158, 11, 0.1); color: var(--warning-color); } /* æ©™è‰²è¡¨ç¤ºè­¦å‘Šï¼Œå¦‚æœªç»‘å®šå¾®ä¿¡ */

        /* --- æ¨é€ç”¨æˆ·é…ç½®ç‰¹å®šæ ·å¼ --- */
        /* (æš‚æ— ç‰¹åˆ«æ ·å¼ï¼Œä½¿ç”¨é€šç”¨è¡¨æ ¼å’ŒæŒ‰é’®) */

        /* --- æ¨¡æ¿é€‰ç”¨ç‰¹å®šæ ·å¼ --- */
        .device-template-list { margin-top: 15px; }
        .device-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 15px;
            background-color: #fff;
            transition: box-shadow 0.2s;
        }
        .device-item:hover { box-shadow: var(--shadow); }
        .device-info { display: flex; align-items: center; gap: 15px; }
        .device-icon { font-size: 1.8rem; color: var(--primary-color); }
        .device-name { font-weight: 500; font-size: 1.1rem; }
        .template-status { font-size: 0.9rem; color: var(--gray-text); }
        .template-status .selected { color: var(--primary-color); font-weight: 500; }
        .template-status .not-selected { color: var(--warning-color); }

        /* --- æ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡† --- */
        .modal {
            display: none; /* é»˜è®¤éšè— */
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.4);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal.active { display: flex; } /* ç”¨äºæ˜¾ç¤ºæ¨¡æ€æ¡† */
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-height: 85vh; /* æœ€å¤§é«˜åº¦ */
            display: flex;
            flex-direction: column;
        }
        #template-select-modal .modal-content { /* æ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†å¯ä»¥å®½ä¸€äº› */
             width: 80%;
             max-width: 900px;
        }
        #user-edit-modal .modal-content { /* ç”¨æˆ·ç¼–è¾‘æ¨¡æ€æ¡†å¯ä»¥çª„ä¸€äº› */
             width: 60%;
             max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .modal-title { font-size: 1.25rem; font-weight: 500; }
        .close-modal { cursor: pointer; font-size: 1.8rem; color: var(--gray-text); border: none; background: none;}
        .modal-body { overflow-y: auto; /* å†…å®¹è¿‡å¤šæ—¶å¯æ»šåŠ¨ */ padding-right: 10px; /* é˜²æ­¢æ»šåŠ¨æ¡é®æŒ¡å†…å®¹ */ }

        /* æ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†å†…çš„æœç´¢å’Œè¿‡æ»¤ */
        .template-search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        .search-box { /* å¤ç”¨ site-config çš„æ ·å¼ */
            display: flex;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
            background-color: white;
            flex-grow: 1; /* è®©æœç´¢æ¡†å æ®æ›´å¤šç©ºé—´ */
        }
        .search-input { padding: 8px 12px; border: none; outline: none; font-size: 14px; width: 100%; }
        .search-btn { background-color: var(--light-color); border: none; padding: 8px 12px; cursor: pointer; color: var(--gray-text); }
        .search-btn:hover { background-color: var(--border-color); }
        .filter-select { padding: 8px 12px; border: 1px solid var(--border-color); border-radius: var(--radius); font-size: 14px; height: 38px; /* ä¸æœç´¢æ¡†å¯¹é½ */ }

        /* æ¨¡æ¿å¡ç‰‡ */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* å“åº”å¼ç½‘æ ¼å¸ƒå±€ */
            gap: 20px;
            margin-top: 10px;
        }
        .template-card {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 15px;
            background-color: #fff;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .template-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 10px rgba(73, 161, 141, 0.1);
            transform: translateY(-2px);
        }
        .template-card.selected { /* é€‰ä¸­æ—¶çš„æ ·å¼ */
            border-color: var(--primary-color);
            background-color: var(--table-hover-bg);
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        .template-card h4 { font-size: 1.1rem; margin-bottom: 10px; color: var(--primary-color); }
        .template-card p { font-size: 0.9rem; color: var(--gray-text); margin-bottom: 5px; line-height: 1.4; }
        .template-card p strong { color: var(--text-color); font-weight: 500; margin-right: 5px; }

        /* æ¨¡æ€æ¡†åº•éƒ¨ */
        .modal-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end; /* æŒ‰é’®é å³ */
            gap: 10px;
        }
        /* å¼ºåˆ¶æ¨¡æ€æ¡†åº•éƒ¨æŒ‰é’®å­—ä½“å¤§å°ä¸€è‡´ (ä¿®å¤ç”¨æˆ·æŠ¥å‘Šé—®é¢˜) */
        .modal-footer .btn {
             font-size: 14px !important; /* ç¡®ä¿å­—ä½“å¤§å°ä¸º14px */
        }

        /* åˆ†é¡µæ ·å¼ (å¦‚æœéœ€è¦) */
        .pagination { display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-top: 20px; }
        .page-info { font-size: 14px; color: var(--gray-text); }
        .pagination-btn { width: 32px; height: 32px; border-radius: 4px; display: flex; align-items: center; justify-content: center; background-color: white; border: 1px solid var(--border-color); color: var(--gray-text); cursor: pointer; }
        .pagination-btn:hover { background-color: var(--light-color); }
        .pagination-btn:disabled { cursor: not-allowed; opacity: 0.5; }

        /* è¾“å…¥æ¡†å’Œè¡¨å•ç»„ */
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-group label .required { color: var(--danger-color); margin-right: 4px; }
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group select,
        .form-group .readonly-input { /* ä¸ºåªè¯»ä¿¡æ¯æ·»åŠ æ ·å¼ */
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            box-sizing: border-box; /* ç¡®ä¿ padding ä¸ä¼šæ’‘å¤§å…ƒç´  */
            background-color: var(--disabled-bg); /* åªè¯»èƒŒæ™¯è‰² */
            color: var(--disabled-text); /* åªè¯»æ–‡å­—é¢œè‰² */
            cursor: default; /* é»˜è®¤å…‰æ ‡ï¼Œè¡¨ç¤ºä¸å¯äº¤äº’ */
        }
        .form-group input[type="text"]:not(.readonly-input),
        .form-group select:not(.readonly-input) { /* å¯ç¼–è¾‘çš„ select å’Œ input æ¢å¤é»˜è®¤æ ·å¼ */
             background-color: white;
             color: var(--text-color);
             cursor: text; /* æ–‡æœ¬è¾“å…¥å…‰æ ‡ */
        }
        .form-group select:not(.readonly-input) { cursor: pointer; } /* ä¸‹æ‹‰æ¡†ç”¨æŒ‡é’ˆå…‰æ ‡ */

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }

        /* æç¤ºä¿¡æ¯ */
        .info-tooltip {
            margin-left: 8px;
            color: var(--gray-text);
            cursor: help;
        }
        .info-tooltip:hover {
            color: var(--primary-color);
        }

    </style>
</head>
<body>
    <!-- å¯¼èˆªæ å®¹å™¨ -->
    <div id="navbar-container"></div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- é¢åŒ…å±‘å¯¼èˆª (ä¿®æ”¹) -->
        <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="site-homepage.html">é¦–é¡µ</a></li>
            <li class="breadcrumb-item">åå°ç®¡ç†</li>
            <li class="breadcrumb-item"><a href="site-config.html">ç«™ç‚¹ç®¡ç†</a></li>
            <!-- ç«™ç‚¹é…ç½®é“¾æ¥ï¼Œå°†åœ¨ JS ä¸­åŠ¨æ€è®¾ç½® href -->
            <li class="breadcrumb-item"><a href="#" id="breadcrumb-site-config">ç«™ç‚¹é…ç½®</a></li>
            <li class="breadcrumb-item active">å‘Šè­¦æ¨é€æ¨¡æ¿é€‰ç”¨</li>
        </ul>

        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title" id="page-title-site-name">å‘Šè­¦æ¨é€æ¨¡æ¿é€‰ç”¨ (ç«™ç‚¹åŠ è½½ä¸­...)</h1>
        </div>

        <!-- ğŸŸ¦ æ¨é€ç”¨æˆ·é…ç½®éƒ¨åˆ† -->
        <div class="content-block">
            <div class="block-header">
                <h2 class="block-title"><i class="fas fa-users"></i> é…ç½®æ¨é€ç”¨æˆ·</h2>
                <div>
                    <button class="btn btn-secondary" id="add-user-btn">
                        <i class="fas fa-user-plus"></i> æ–°å¢ç”¨æˆ·
                    </button>
                    <!-- ä¿®æ”¹æŒ‰é’®æ–‡å­— -->
                    <button class="btn btn-primary" id="save-users-btn">
                        <i class="fas fa-save"></i> ä¿å­˜
                    </button>
                    <i class="fas fa-info-circle info-tooltip" title="ä¸ºå½“å‰ç«™ç‚¹é…ç½®æ¥æ”¶å‘Šè­¦ä¿¡æ¯çš„ç”¨æˆ·åŠå…¶çº§åˆ«å’ŒçŠ¶æ€ã€‚"></i>
                </div>
            </div>
            <div class="table-container">
                <table id="user-table">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>è¢«æ¨é€ç”¨æˆ·</th>
                            <th>ç”¨æˆ·æ‰‹æœºå·</th>
                            <th>ç”¨æˆ·é‚®ç®±</th>
                            <th>ç”¨æˆ·å¾®ä¿¡</th>
                            <th>ç”¨æˆ·çº§åˆ«</th>
                            <th>çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body">
                        <!-- ç”¨æˆ·æ•°æ®å°†ç”± JS åŠ¨æ€åŠ è½½ -->
                        <tr><td colspan="8" style="text-align: center; color: var(--gray-text); padding: 20px;">åŠ è½½ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
            <!-- ç”¨æˆ·è¡¨æ ¼åˆ†é¡µ (å¦‚æœéœ€è¦) -->
            <!-- <div class="pagination"> ... </div> -->
        </div>

        <!-- ğŸŸ© æ¨¡æ¿é€‰ç”¨éƒ¨åˆ† -->
        <div class="content-block">
            <div class="block-header">
                <h2 class="block-title"><i class="fas fa-clipboard-list"></i> ä¸ºè®¾å¤‡é€‰ç”¨å‘Šè­¦æ¨¡æ¿</h2>
                 <i class="fas fa-info-circle info-tooltip" title="ä¸ºç«™ç‚¹ä¸‹çš„æ¯å°è®¾å¤‡é€‰æ‹©ä¸€ä¸ªå‘Šè­¦æ¨é€æ¨¡æ¿ã€‚æ¨¡æ¿å†³å®šäº†å“ªäº›å‘Šè­¦ç‚¹ä½ä¼šè§¦å‘æ¨é€ã€‚"></i>
            </div>
            <div class="device-template-list" id="device-list">
                <!-- æ¨¡æ‹Ÿè®¾å¤‡æ•°æ® -->
                <div class="device-item" data-device-id="PCS001">
                    <div class="device-info">
                        <i class="fas fa-car-battery device-icon"></i>
                        <div>
                            <div class="device-name">1#å‚¨èƒ½æŸœ</div>
                            <div class="template-status">å·²é€‰ç”¨æ¨¡æ¿: <span class="selected">é»˜è®¤å‚¨èƒ½æŸœæ¨¡æ¿</span></div>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-small select-template-btn">
                        <i class="fas fa-exchange-alt"></i> æ›´æ¢æ¨¡æ¿
                    </button>
                </div>
                <div class="device-item" data-device-id="PCS002">
                    <div class="device-info">
                        <i class="fas fa-car-battery device-icon"></i>
                        <div>
                            <div class="device-name">2#å‚¨èƒ½æŸœ</div>
                            <div class="template-status"><span class="not-selected">æœªé€‰ç”¨æ¨¡æ¿</span></div>
                        </div>
                    </div>
                    <button class="btn btn-secondary btn-small select-template-btn">
                        <i class="fas fa-plus-circle"></i> é€‰æ‹©æ¨¡æ¿
                    </button>
                </div>
                <div class="device-item" data-device-id="CHG001">
                    <div class="device-info">
                        <i class="fas fa-charging-station device-icon"></i>
                        <div>
                            <div class="device-name">1#å……ç”µæ¡©</div>
                            <div class="template-status"><span class="not-selected">æœªé€‰ç”¨æ¨¡æ¿</span></div>
                        </div>
                    </div>
                    <button class="btn btn-secondary btn-small select-template-btn">
                         <i class="fas fa-plus-circle"></i> é€‰æ‹©æ¨¡æ¿
                    </button>
                </div>
                <div class="device-item" data-device-id="CHG002">
                    <div class="device-info">
                         <i class="fas fa-charging-station device-icon"></i>
                        <div>
                            <div class="device-name">2#å……ç”µæ¡©</div>
                            <div class="template-status">å·²é€‰ç”¨æ¨¡æ¿: <span class="selected">é‡è¦å……ç”µæ¡©æ¨¡æ¿</span></div>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-small select-template-btn">
                        <i class="fas fa-exchange-alt"></i> æ›´æ¢æ¨¡æ¿
                    </button>
                </div>
                 <!-- æ›´å¤šè®¾å¤‡... -->
            </div>
             <!-- è®¾å¤‡åˆ—è¡¨åˆ†é¡µ (å¦‚æœè®¾å¤‡å¾ˆå¤š) -->
            <!-- <div class="pagination"> ... </div> -->
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† - é€‰æ‹©å‘Šè­¦æ¨¡æ¿ -->
    <div class="modal" id="template-select-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ä¸º <span id="modal-device-name"></span> é€‰æ‹©å‘Šè­¦æ¨¡æ¿</h3>
                <button class="close-modal" aria-label="å…³é—­">&times;</button>
            </div>
            <div class="modal-body">
                <!-- æœç´¢å’Œè¿‡æ»¤ -->
                <div class="template-search-filter">
                    <div class="search-box">
                        <input type="text" class="search-input" id="template-search-input" placeholder="æœç´¢æ¨¡æ¿åç§°...">
                        <button class="search-btn" id="template-search-btn"><i class="fas fa-search"></i></button>
                    </div>
                    <select id="template-filter-type" class="filter-select">
                        <option value="">æ‰€æœ‰è®¾å¤‡ç±»å‹</option>
                        <option value="å‚¨èƒ½æŸœ">å‚¨èƒ½æŸœ</option>
                        <option value="å……ç”µæ¡©">å……ç”µæ¡©</option>
                        <option value="é€†å˜å™¨">é€†å˜å™¨</option>
                        <!-- æ›´å¤šç±»å‹... -->
                    </select>
                </div>

                <!-- æ¨¡æ¿åˆ—è¡¨ -->
                <div class="template-grid" id="template-grid">
                    <!-- æ¨¡æ‹Ÿæ¨¡æ¿å¡ç‰‡ -->
                    <div class="template-card" data-template-id="TPL001" data-template-name="é»˜è®¤å‚¨èƒ½æŸœæ¨¡æ¿">
                        <h4>é»˜è®¤å‚¨èƒ½æŸœæ¨¡æ¿</h4>
                        <p><strong>åˆ›å»ºäºº:</strong> ç³»ç»Ÿç®¡ç†å‘˜</p>
                        <p><strong>åˆ›å»ºæ—¶é—´:</strong> 2024-01-15 10:00</p>
                        <p><strong>é€‚é…è®¾å¤‡:</strong> å‚¨èƒ½æŸœ</p>
                    </div>
                    <div class="template-card" data-template-id="TPL002" data-template-name="é‡è¦å‚¨èƒ½æŸœæ¨¡æ¿">
                        <h4>é‡è¦å‚¨èƒ½æŸœæ¨¡æ¿</h4>
                        <p><strong>åˆ›å»ºäºº:</strong> æå·¥</p>
                        <p><strong>åˆ›å»ºæ—¶é—´:</strong> 2024-03-20 14:30</p>
                        <p><strong>é€‚é…è®¾å¤‡:</strong> å‚¨èƒ½æŸœ</p>
                    </div>
                    <div class="template-card" data-template-id="TPL003" data-template-name="æ ‡å‡†å……ç”µæ¡©æ¨¡æ¿">
                        <h4>æ ‡å‡†å……ç”µæ¡©æ¨¡æ¿</h4>
                        <p><strong>åˆ›å»ºäºº:</strong> ç³»ç»Ÿç®¡ç†å‘˜</p>
                        <p><strong>åˆ›å»ºæ—¶é—´:</strong> 2024-02-01 09:00</p>
                        <p><strong>é€‚é…è®¾å¤‡:</strong> å……ç”µæ¡©</p>
                    </div>
                     <div class="template-card" data-template-id="TPL004" data-template-name="é‡è¦å……ç”µæ¡©æ¨¡æ¿">
                        <h4>é‡è¦å……ç”µæ¡©æ¨¡æ¿</h4>
                        <p><strong>åˆ›å»ºäºº:</strong> ç‹å·¥</p>
                        <p><strong>åˆ›å»ºæ—¶é—´:</strong> 2024-05-10 11:00</p>
                        <p><strong>é€‚é…è®¾å¤‡:</strong> å……ç”µæ¡©</p>
                    </div>
                    <div class="template-card" data-template-id="TPL005" data-template-name="é€šç”¨å‘Šè­¦æ¨¡æ¿">
                        <h4>é€šç”¨å‘Šè­¦æ¨¡æ¿</h4>
                        <p><strong>åˆ›å»ºäºº:</strong> ç³»ç»Ÿç®¡ç†å‘˜</p>
                        <p><strong>åˆ›å»ºæ—¶é—´:</strong> 2023-12-01 16:00</p>
                        <p><strong>é€‚é…è®¾å¤‡:</strong> æ‰€æœ‰ç±»å‹</p>
                    </div>
                    <!-- æ›´å¤šæ¨¡æ¿... -->
                </div>
                 <!-- æ¨¡æ¿åˆ†é¡µ -->
                 <div class="pagination" id="template-pagination">
                     <span class="page-info">å…± 15 ä¸ªæ¨¡æ¿ï¼Œå½“å‰æ˜¾ç¤º 1-5</span>
                     <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                     <button class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
                 </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirm-template-select">ç¡®å®šé€‰ç”¨</button>
            </div>
        </div>
    </div>

     <!-- æ¨¡æ€æ¡† - æ–°å¢/ç¼–è¾‘ç”¨æˆ· -->
    <div class="modal" id="user-edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="user-modal-title">æ–°å¢ç”¨æˆ·</h3>
                <button class="close-modal" aria-label="å…³é—­">&times;</button>
            </div>
            <div class="modal-body">
                <form id="user-form">
                    <!-- éšè—å­—æ®µï¼Œç”¨äºå­˜å‚¨æ­£åœ¨ç¼–è¾‘çš„ç”¨æˆ·ID -->
                    <input type="hidden" id="editing-user-id">

                    <!-- æ–°å¢ç”¨æˆ·æ—¶çš„ç”¨æˆ·é€‰æ‹© -->
                    <div class="form-group" id="add-user-select-group">
                        <label for="select-user"><span class="required">*</span>é€‰æ‹©ç”¨æˆ·</label>
                        <select id="select-user" required>
                            <option value="">-- è¯·é€‰æ‹©è¦æ·»åŠ çš„ç”¨æˆ· --</option>
                            <!-- é€‰é¡¹å°†åœ¨ JS ä¸­åŠ¨æ€å¡«å…… -->
                        </select>
                    </div>

                    <!-- ç¼–è¾‘ç”¨æˆ·æ—¶æ˜¾ç¤ºçš„ä¿¡æ¯ -->
                    <div class="form-group" id="edit-user-info-group" style="display: none;">
                         <label>è¢«æ¨é€ç”¨æˆ·</label>
                         <div id="edit-user-name" class="readonly-input"></div>
                         <!-- å¯ä»¥é€‰æ‹©æ€§åœ°æ˜¾ç¤ºæ›´å¤šåªè¯»ä¿¡æ¯ -->
                         <!-- <label>ç”¨æˆ·æ‰‹æœºå·</label> -->
                         <!-- <div id="edit-user-phone" class="readonly-input"></div> -->
                    </div>

                    <!-- å…¬å…±ç¼–è¾‘éƒ¨åˆ†ï¼šçº§åˆ«å’ŒçŠ¶æ€ -->
                    <div class="form-group">
                        <label for="user-level"><span class="required">*</span>ç”¨æˆ·çº§åˆ«</label>
                        <select id="user-level" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="ä¸€çº§">ä¸€çº§</option>
                            <option value="äºŒçº§">äºŒçº§</option>
                            <option value="ä¸‰çº§">ä¸‰çº§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="user-status"><span class="required">*</span>çŠ¶æ€</label>
                        <select id="user-status" required>
                             <option value="active">å¯ç”¨</option>
                             <option value="inactive">åœç”¨</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <!-- ç¡®ä¿å–æ¶ˆæŒ‰é’®ä½¿ç”¨æ ‡å‡† btn å’Œ btn-secondary ç±» -->
                <button class="btn btn-secondary close-modal">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="save-user-data">ç¡®å®š</button>
            </div>
        </div>
    </div>


    <!-- å¼•å…¥é¡µé¢è„šæœ¬ -->
    <script>
        // æ¨¡æ‹Ÿçš„ç³»ç»Ÿç”¨æˆ·æ•°æ® (å®é™…åº”ç”¨ä¸­åº”ä»åç«¯è·å–)
        const MOCK_SYSTEM_USERS = [
            { id: 'user001', name: 'å¼ ä¸‰', phone: '138****1234', email: 'zhangsan@example.com', wechatBound: true },
            { id: 'user002', name: 'æå››', phone: '139****5678', email: 'lisi@example.com', wechatBound: false },
            { id: 'user003', name: 'ç‹äº”', phone: '137****9012', email: 'wangwu@example.com', wechatBound: true },
            { id: 'user004', name: 'èµµå…­', phone: '136****3456', email: 'zhaoliu@example.com', wechatBound: true },
            { id: 'user005', name: 'å­™ä¸ƒ', phone: '135****7890', email: 'sunqi@example.com', wechatBound: false },
        ];

        // æ¨¡æ‹Ÿå½“å‰å·²é…ç½®çš„ç”¨æˆ·åˆ—è¡¨ (å¯ä»¥ä»è¡¨æ ¼åˆå§‹åŒ–ï¼Œæˆ–ä»åç«¯è·å–)
        let configuredUsers = [
            // åˆå§‹æ•°æ®ä» HTML ç§»é™¤ï¼Œç”± JS åŠ è½½
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // 1. åˆå§‹åŒ–å¯¼èˆªæ 
            if (typeof initNavbar === 'function') {
                initNavbar();
                // æ ¹æ®å®é™…æƒ…å†µè®¾ç½®æ´»åŠ¨èœå•é¡¹
                // setActiveMenuItem('menu-admin', 'submenu-site-config'); // ç¤ºä¾‹
            }

            // 2. è·å–å¹¶è®¾ç½®ç«™ç‚¹åç§°
            const urlParams = new URLSearchParams(window.location.search);
            const siteNameParam = urlParams.get('siteName'); // è·å–åŸå§‹å‚æ•°
            const siteName = siteNameParam ? decodeURIComponent(siteNameParam) : "é»˜è®¤ç«™ç‚¹";

            // æ›´æ–°é¡µé¢æ ‡é¢˜
            const pageTitleSiteName = document.getElementById('page-title-site-name');
            if (pageTitleSiteName) {
                 pageTitleSiteName.textContent = `å‘Šè­¦æ¨é€æ¨¡æ¿é€‰ç”¨ (${siteName})`;
            }

            // æ›´æ–°é¢åŒ…å±‘ä¸­çš„ç«™ç‚¹é…ç½®é“¾æ¥
            const breadcrumbSiteConfig = document.getElementById('breadcrumb-site-config');
            if (breadcrumbSiteConfig) {
                 // ç¡®ä¿ä½¿ç”¨ encodeURIComponent å¯¹å‚æ•°è¿›è¡Œç¼–ç ï¼Œå¹¶æŒ‡å‘æ­£ç¡®çš„é¡µé¢
                 const configHref = `site-config-detail.html?siteName=${encodeURIComponent(siteNameParam || 'é»˜è®¤ç«™ç‚¹')}`;
                 breadcrumbSiteConfig.href = configHref;
                 console.log("è®¾ç½®'ç«™ç‚¹é…ç½®'é¢åŒ…å±‘é“¾æ¥ä¸º:", configHref); // æ·»åŠ æ—¥å¿—
            } else {
                 console.error("æœªèƒ½æ‰¾åˆ° ID ä¸º 'breadcrumb-site-config' çš„é¢åŒ…å±‘é“¾æ¥å…ƒç´ ã€‚");
            }

            // --- DOMå…ƒç´ è·å– ---
            const userTableBody = document.getElementById('user-table-body');
            const userEditModal = document.getElementById('user-edit-modal');
            const addUserBtn = document.getElementById('add-user-btn');
            const userModalCloseBtns = userEditModal.querySelectorAll('.close-modal');
            const saveUserDataBtn = document.getElementById('save-user-data');
            const userModalTitle = document.getElementById('user-modal-title');
            const userForm = document.getElementById('user-form');
            const editingUserIdInput = document.getElementById('editing-user-id'); // ç”¨äºç¼–è¾‘
            const addUserSelectGroup = document.getElementById('add-user-select-group');
            const selectUserInput = document.getElementById('select-user'); // æ–°å¢æ—¶é€‰æ‹©ç”¨æˆ·
            const editUserInfoGroup = document.getElementById('edit-user-info-group');
            const editUserNameDiv = document.getElementById('edit-user-name'); // ç¼–è¾‘æ—¶æ˜¾ç¤ºç”¨æˆ·å
            const userLevelSelect = document.getElementById('user-level');
            const userStatusSelect = document.getElementById('user-status');

            // --- æ¨¡æ‹ŸåŠ è½½åˆå§‹ç”¨æˆ·æ•°æ® (æ›¿æ¢HTMLä¸­çš„é™æ€æ•°æ®) ---
            function loadInitialUsers() {
                // æ¨¡æ‹Ÿä»åç«¯åŠ è½½å·²é…ç½®ç”¨æˆ·
                // è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„ configuredUsers æ¨¡æ‹Ÿæ•°æ®
                configuredUsers = [
                    { id: 'user001', name: 'å¼ ä¸‰', phone: '138****1234', email: 'zhangsan@example.com', wechatBound: true, level: 'ä¸€çº§', status: 'active' },
                    { id: 'user002', name: 'æå››', phone: '139****5678', email: 'lisi@example.com', wechatBound: false, level: 'äºŒçº§', status: 'active' },
                    { id: 'user003', name: 'ç‹äº”', phone: '137****9012', email: 'wangwu@example.com', wechatBound: true, level: 'ä¸‰çº§', status: 'inactive' },
                ];
                renderUserTable();
            }

            // --- æ¸²æŸ“ç”¨æˆ·è¡¨æ ¼ ---
            function renderUserTable() {
                userTableBody.innerHTML = ''; // æ¸…ç©ºç°æœ‰è¡¨æ ¼
                if (configuredUsers.length === 0) {
                    userTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--gray-text); padding: 20px;">æš‚æ— é…ç½®ç”¨æˆ·</td></tr>';
                    return;
                }
                configuredUsers.forEach((user, index) => {
                    const newRow = userTableBody.insertRow();
                    newRow.dataset.userId = user.id; // ä½¿ç”¨çœŸå®ç”¨æˆ·ID

                    const wechatStatusText = user.wechatBound ? 'å·²ç»‘å®š' : 'æœªç»‘å®š';
                    const wechatStatusClass = user.wechatBound ? 'status-active' : 'status-warning';
                    const statusText = user.status === 'active' ? 'å¯ç”¨' : 'åœç”¨';
                    const statusClass = user.status === 'active' ? 'status-active' : 'status-inactive';

                    newRow.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${user.name}</td>
                        <td>${user.phone || '-'}</td>
                        <td>${user.email || '-'}</td>
                        <td><span class="status-badge ${wechatStatusClass}">${wechatStatusText}</span></td>
                        <td>${user.level}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td class="action-btns">
                            <button class="action-btn edit" title="ç¼–è¾‘"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete" title="åˆ é™¤"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    `;
                });
            }
            loadInitialUsers(); // é¡µé¢åŠ è½½æ—¶åŠ è½½å¹¶æ¸²æŸ“

            // --- å¡«å……æ–°å¢ç”¨æˆ·ä¸‹æ‹‰åˆ—è¡¨ ---
            function populateAddUserSelect() {
                selectUserInput.innerHTML = '<option value="">-- è¯·é€‰æ‹©è¦æ·»åŠ çš„ç”¨æˆ· --</option>'; // é‡ç½®
                const configuredUserIds = configuredUsers.map(u => u.id);

                MOCK_SYSTEM_USERS.forEach(sysUser => {
                    // åªæ˜¾ç¤ºå°šæœªæ·»åŠ åˆ°æ­¤ç«™ç‚¹é…ç½®ä¸­çš„ç”¨æˆ·
                    if (!configuredUserIds.includes(sysUser.id)) {
                        const option = document.createElement('option');
                        option.value = sysUser.id;
                        option.textContent = `${sysUser.name} (${sysUser.phone || 'æ— æ‰‹æœºå·'})`; // æ˜¾ç¤ºå§“åå’Œç”µè¯ä»¥ä¾¿åŒºåˆ†
                        selectUserInput.appendChild(option);
                    }
                });
            }

            // --- ç”¨æˆ·æ¨¡æ€æ¡†é€šç”¨æ“ä½œ ---
            function openUserModal() { userEditModal.classList.add('active'); }
            function closeUserModal() { userEditModal.classList.remove('active'); }
            userModalCloseBtns.forEach(btn => btn.addEventListener('click', closeUserModal));
            userEditModal.addEventListener('click', (event) => {
                if (event.target === userEditModal) closeUserModal();
            });

            // --- æ–°å¢ç”¨æˆ·é€»è¾‘ ---
            addUserBtn.addEventListener('click', function() {
                userModalTitle.textContent = 'æ–°å¢æ¨é€ç”¨æˆ·';
                userForm.reset(); // æ¸…ç©ºè¡¨å•
                editingUserIdInput.value = ''; // æ¸…ç©ºç¼–è¾‘ID
                addUserSelectGroup.style.display = 'block'; // æ˜¾ç¤ºç”¨æˆ·é€‰æ‹©ä¸‹æ‹‰æ¡†
                editUserInfoGroup.style.display = 'none'; // éšè—ç¼–è¾‘æ—¶çš„åªè¯»ä¿¡æ¯
                populateAddUserSelect(); // å¡«å……å¯é€‰ç”¨æˆ·åˆ—è¡¨
                userLevelSelect.value = 'äºŒçº§'; // é»˜è®¤çº§åˆ«
                userStatusSelect.value = 'active'; // é»˜è®¤çŠ¶æ€
                openUserModal();
            });

            // --- ç¼–è¾‘ç”¨æˆ·é€»è¾‘ ---
            userTableBody.addEventListener('click', function(event) {
                const editButton = event.target.closest('.action-btn.edit');
                if (editButton) {
                    const rowToEdit = editButton.closest('tr');
                    const userId = rowToEdit.dataset.userId;
                    const user = configuredUsers.find(u => u.id === userId);

                    if (user) {
                        userModalTitle.textContent = `ç¼–è¾‘ç”¨æˆ·: ${user.name}`;
                        editingUserIdInput.value = user.id; // è®¾ç½®ç¼–è¾‘ID
                        addUserSelectGroup.style.display = 'none'; // éšè—ç”¨æˆ·é€‰æ‹©ä¸‹æ‹‰æ¡†
                        editUserInfoGroup.style.display = 'block'; // æ˜¾ç¤ºç¼–è¾‘æ—¶çš„åªè¯»ä¿¡æ¯
                        editUserNameDiv.textContent = user.name; // æ˜¾ç¤ºç”¨æˆ·å

                        // å¡«å……å½“å‰ç”¨æˆ·çš„çº§åˆ«å’ŒçŠ¶æ€
                        userLevelSelect.value = user.level;
                        userStatusSelect.value = user.status;

                        openUserModal();
                    }
                }
            });

            // --- ä¿å­˜ç”¨æˆ·æ•°æ® (æ–°å¢/ç¼–è¾‘) ---
            saveUserDataBtn.addEventListener('click', function() {
                const editingId = editingUserIdInput.value;
                const selectedLevel = userLevelSelect.value;
                const selectedStatus = userStatusSelect.value;

                if (!selectedLevel) {
                    alert('è¯·é€‰æ‹©ç”¨æˆ·çº§åˆ«ï¼');
                    return;
                }

                if (editingId) {
                    // --- ç¼–è¾‘æ¨¡å¼ ---
                    const userIndex = configuredUsers.findIndex(u => u.id === editingId);
                    if (userIndex > -1) {
                        configuredUsers[userIndex].level = selectedLevel;
                        configuredUsers[userIndex].status = selectedStatus;
                        alert('ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸï¼');
                        renderUserTable(); // é‡æ–°æ¸²æŸ“è¡¨æ ¼
                        closeUserModal();
                    } else {
                        alert('æ‰¾ä¸åˆ°è¦ç¼–è¾‘çš„ç”¨æˆ·ï¼');
                    }
                } else {
                    // --- æ–°å¢æ¨¡å¼ ---
                    const selectedUserId = selectUserInput.value;
                    if (!selectedUserId) {
                        alert('è¯·é€‰æ‹©è¦æ·»åŠ çš„ç”¨æˆ·ï¼');
                        return;
                    }

                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ (ç†è®ºä¸Š select å·²ç»è¿‡æ»¤äº†ï¼Œä½†åŒé‡æ£€æŸ¥æ›´å®‰å…¨)
                    if (configuredUsers.some(u => u.id === selectedUserId)) {
                        alert('è¯¥ç”¨æˆ·å·²åœ¨åˆ—è¡¨ä¸­ï¼');
                        return;
                    }

                    const userToAdd = MOCK_SYSTEM_USERS.find(u => u.id === selectedUserId);
                    if (userToAdd) {
                        configuredUsers.push({
                            ...userToAdd,
                            level: selectedLevel,
                            status: selectedStatus
                        });
                        alert('æ–°å¢ç”¨æˆ·æˆåŠŸï¼');
                        renderUserTable(); // é‡æ–°æ¸²æŸ“è¡¨æ ¼
                        closeUserModal();
                    } else {
                        alert('æ‰¾ä¸åˆ°æ‰€é€‰çš„ç”¨æˆ·ä¿¡æ¯ï¼');
                    }
                }
            });

             // --- åˆ é™¤ç”¨æˆ· --- (äº‹ä»¶å§”æ‰˜)
             userTableBody.addEventListener('click', function(event) {
                const deleteButton = event.target.closest('.action-btn.delete');
                 if (deleteButton) {
                     const rowToDelete = deleteButton.closest('tr');
                     const userIdToDelete = rowToDelete.dataset.userId;
                     const userToDelete = configuredUsers.find(u => u.id === userIdToDelete);

                     if (userToDelete && confirm(`ç¡®å®šè¦ä»æ¨é€åˆ—è¡¨ä¸­ç§»é™¤ç”¨æˆ· "${userToDelete.name}" å—ï¼Ÿ`)) {
                         configuredUsers = configuredUsers.filter(u => u.id !== userIdToDelete);
                         renderUserTable(); // é‡æ–°æ¸²æŸ“è¡¨æ ¼
                         alert(`ç”¨æˆ· "${userToDelete.name}" å·²ç§»é™¤ã€‚`);
                     }
                 }
             });

            // --- ä¿å­˜æŒ‰é’® (åŸä¿å­˜ç”¨æˆ·é…ç½®) ---
            const saveUsersBtn = document.getElementById('save-users-btn');
            saveUsersBtn.addEventListener('click', function() {
                let hasUnboundWechat = false;
                configuredUsers.forEach(user => {
                    // ä» MOCK_SYSTEM_USERS è·å–æœ€æ–°çš„ç»‘å®šçŠ¶æ€ï¼ˆæˆ–å®é™…åº”ä»åç«¯è·å–ï¼‰
                    const systemUser = MOCK_SYSTEM_USERS.find(su => su.id === user.id);
                    if (systemUser && !systemUser.wechatBound) {
                         hasUnboundWechat = true;
                    }
                    // å¦‚æœ configuredUsers è‡ªèº«ä¹Ÿå­˜å‚¨äº† wechatBound çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ user.wechatBound
                });

                let message = "é…ç½®å·²ä¿å­˜ï¼"; // ä¿®æ”¹æç¤º
                if (hasUnboundWechat) {
                    message += "\n\næ³¨æ„ï¼šåˆ—è¡¨ä¸­å­˜åœ¨å¾®ä¿¡æœªç»‘å®šçš„ç”¨æˆ·ï¼Œå¯èƒ½æ— æ³•æ¥æ”¶å¾®ä¿¡å‘Šè­¦æ¨é€ã€‚";
                }
                alert(message);
                console.log("ä¿å­˜æ“ä½œè§¦å‘ï¼ˆæ¨¡æ‹Ÿï¼‰ï¼Œå½“å‰é…ç½®ç”¨æˆ·:", JSON.stringify(configuredUsers));
                 // æ­¤å¤„åº”æœ‰å®é™…çš„åç«¯äº¤äº’é€»è¾‘ï¼Œå‘é€ configuredUsers æ•°æ®
            });

            // --- æ¨¡æ¿é€‰æ‹©æ¨¡æ€æ¡†ç›¸å…³ (ä¿æŒä¸å˜) ---
            const templateSelectModal = document.getElementById('template-select-modal');
            const selectTemplateBtns = document.querySelectorAll('.select-template-btn');
            const templateModalCloseBtns = templateSelectModal.querySelectorAll('.close-modal');
            const confirmSelectBtn = document.getElementById('confirm-template-select');
            const modalDeviceName = document.getElementById('modal-device-name');
            const templateGrid = document.getElementById('template-grid');
            let currentDeviceItem = null; // å­˜å‚¨å½“å‰æ­£åœ¨æ“ä½œçš„è®¾å¤‡é¡¹
            let selectedTemplateCard = null; // å­˜å‚¨å½“å‰æ¨¡æ€æ¡†ä¸­é€‰ä¸­çš„æ¨¡æ¿å¡ç‰‡

            selectTemplateBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentDeviceItem = this.closest('.device-item');
                    const deviceName = currentDeviceItem.querySelector('.device-name').textContent;
                    modalDeviceName.textContent = deviceName;
                    if (selectedTemplateCard) {
                        selectedTemplateCard.classList.remove('selected');
                        selectedTemplateCard = null;
                    }
                    document.getElementById('template-search-input').value = '';
                    document.getElementById('template-filter-type').selectedIndex = 0;
                    const currentTemplateName = currentDeviceItem.querySelector('.template-status .selected')?.textContent;
                    const cards = templateGrid.querySelectorAll('.template-card');
                    cards.forEach(card => {
                        card.style.display = ''; // å…ˆç¡®ä¿æ‰€æœ‰å¡ç‰‡å¯è§
                        if (card.dataset.templateName === currentTemplateName) {
                            card.classList.add('selected');
                            selectedTemplateCard = card;
                        } else {
                            card.classList.remove('selected');
                        }
                    });
                    templateSelectModal.classList.add('active');
                });
            });

            templateModalCloseBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    templateSelectModal.classList.remove('active');
                });
            });
            templateSelectModal.addEventListener('click', function(event) {
                if (event.target === templateSelectModal) {
                    templateSelectModal.classList.remove('active');
                }
            });

            templateGrid.addEventListener('click', function(event) {
                const targetCard = event.target.closest('.template-card');
                if (!targetCard) return;
                if (selectedTemplateCard) {
                    selectedTemplateCard.classList.remove('selected');
                }
                targetCard.classList.add('selected');
                selectedTemplateCard = targetCard;
            });

            confirmSelectBtn.addEventListener('click', function() {
                if (!selectedTemplateCard) {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿ï¼');
                    return;
                }
                if (!currentDeviceItem) return;
                const templateName = selectedTemplateCard.dataset.templateName;
                const templateStatusElement = currentDeviceItem.querySelector('.template-status');
                const selectButton = currentDeviceItem.querySelector('.select-template-btn');
                templateStatusElement.innerHTML = `å·²é€‰ç”¨æ¨¡æ¿: <span class="selected">${templateName}</span>`;
                selectButton.innerHTML = '<i class="fas fa-exchange-alt"></i> æ›´æ¢æ¨¡æ¿';
                selectButton.classList.remove('btn-secondary');
                selectButton.classList.add('btn-primary');
                alert(`è®¾å¤‡ "${modalDeviceName.textContent}" å·²é€‰ç”¨æ¨¡æ¿ "${templateName}"`);
                templateSelectModal.classList.remove('active');
            });

            const templateSearchBtn = document.getElementById('template-search-btn');
            const templateSearchInput = document.getElementById('template-search-input');
            const templateFilterType = document.getElementById('template-filter-type');

            function filterTemplates() {
                 const searchTerm = templateSearchInput.value.toLowerCase().trim();
                 const selectedType = templateFilterType.value;
                 const allCards = templateGrid.querySelectorAll('.template-card');
                 console.log(`æœç´¢: "${searchTerm}", ç±»å‹: "${selectedType}"`);
                 allCards.forEach(card => {
                    const name = card.querySelector('h4').textContent.toLowerCase().trim();
                    let typeText = '';
                    const typeElement = card.querySelector('p:last-of-type');
                    if (typeElement) {
                        const fullText = typeElement.textContent || '';
                        const parts = fullText.split(':');
                        if (parts.length > 1) {
                            typeText = parts[1].trim();
                        }
                    }
                    const nameMatch = name.includes(searchTerm);
                    const typeMatch = !selectedType || typeText === selectedType || typeText === 'æ‰€æœ‰ç±»å‹';
                    if (nameMatch && typeMatch) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }
                 });
                 // TODO: Update pagination based on visible cards
            }

            templateSearchBtn.addEventListener('click', filterTemplates);
            templateSearchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') filterTemplates();
            });
            templateFilterType.addEventListener('change', filterTemplates);
            // --- ç»“æŸæ¨¡æ¿é€‰æ‹© --- 

            console.log("å‘Šè­¦æ¨é€æ¨¡æ¿é€‰ç”¨é¡µé¢è„šæœ¬åˆå§‹åŒ–å®Œæˆã€‚");
        });
    </script>

</body>
</html> 